<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="444px" preserveAspectRatio="none" style="width:898px;height:444px;" version="1.1" viewBox="0 0 898 444" width="898px" zoomAndPan="magnify"><defs><filter height="300%" id="f1mrmeib7yj1se" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="47" x2="47" y1="38.4883" y2="403.9043"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="357.5" x2="357.5" y1="38.4883" y2="403.9043"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="570.5" x2="570.5" y1="38.4883" y2="403.9043"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="723.5" x2="723.5" y1="38.4883" y2="403.9043"/><rect fill="#FEFECE" filter="url(#f1mrmeib7yj1se)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="74" x="8" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="15" y="23.5352">frontend</text><rect fill="#FEFECE" filter="url(#f1mrmeib7yj1se)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="74" x="8" y="402.9043"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="60" x="15" y="423.4395">frontend</text><rect fill="#FEFECE" filter="url(#f1mrmeib7yj1se)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="308.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="315.5" y="23.5352">kubesphere</text><rect fill="#FEFECE" filter="url(#f1mrmeib7yj1se)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="95" x="308.5" y="402.9043"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="81" x="315.5" y="423.4395">kubesphere</text><rect fill="#FEFECE" filter="url(#f1mrmeib7yj1se)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="155" x="491.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="141" x="498.5" y="23.5352">Authorization server</text><rect fill="#FEFECE" filter="url(#f1mrmeib7yj1se)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="155" x="491.5" y="402.9043"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="141" x="498.5" y="423.4395">Authorization server</text><rect fill="#FEFECE" filter="url(#f1mrmeib7yj1se)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="123" x="660.5" y="3"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="109" x="667.5" y="23.5352">Resource server</text><rect fill="#FEFECE" filter="url(#f1mrmeib7yj1se)" height="30.4883" style="stroke: #A80036; stroke-width: 1.5;" width="123" x="660.5" y="402.9043"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="109" x="667.5" y="423.4395">Resource server</text><polygon fill="#A80036" points="346,65.7988,356,69.7988,346,73.7988,350,69.7988" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47" x2="352" y1="69.7988" y2="69.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="135" x="54" y="65.0566">OAuth2 login request</text><polygon fill="#A80036" points="58,95.1094,48,99.1094,58,103.1094,54,99.1094" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52" x2="357" y1="99.1094" y2="99.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="287" x="64" y="94.3672">Redirect to authorization server with client_id</text><polygon fill="#A80036" points="559,124.4199,569,128.4199,559,132.4199,563,128.4199" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47" x2="565" y1="128.4199" y2="128.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="54" y="123.6777">Grant request</text><polygon fill="#A80036" points="58,153.7305,48,157.7305,58,161.7305,54,157.7305" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52" x2="570" y1="157.7305" y2="157.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="64" y="152.9883">Redirect to ks-console with grant code</text><polygon fill="#A80036" points="346,183.041,356,187.041,346,191.041,350,187.041" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="47" x2="352" y1="187.041" y2="187.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="54" y="182.2988">Login request with grant code</text><polygon fill="#A80036" points="559,212.3516,569,216.3516,559,220.3516,563,216.3516" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="358" x2="565" y1="216.3516" y2="216.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="365" y="211.6094">Auth by grant code</text><polygon fill="#A80036" points="369,241.6621,359,245.6621,369,249.6621,365,245.6621" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="570" y1="245.6621" y2="245.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="375" y="240.9199">access_token &amp; refresh_token</text><polygon fill="#A80036" points="712,275.9727,722,279.9727,712,283.9727,716,279.9727" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="358" x2="718" y1="279.9727" y2="279.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="137" x="365" y="275.2305">Describe user request</text><path d="M729,258.6621 L729,283.6621 L886,283.6621 L886,268.6621 L876,258.6621 L729,258.6621 " fill="#FBFB77" filter="url(#f1mrmeib7yj1se)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M876,258.6621 L876,268.6621 L886,268.6621 L876,258.6621 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="735" y="276.2305">auth by access_token</text><polygon fill="#A80036" points="369,310.2832,359,314.2832,369,318.2832,365,314.2832" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="363" x2="723" y1="314.2832" y2="314.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="375" y="309.541">Describe user response</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="358" x2="400" y1="343.5938" y2="343.5938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="400" x2="400" y1="343.5938" y2="356.5938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="359" x2="400" y1="356.5938" y2="356.5938"/><polygon fill="#A80036" points="369,352.5938,359,356.5938,369,360.5938,365,356.5938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="365" y="338.8516">User exist?</text><path d="M445,328.7832 L445,353.7832 L577,353.7832 L577,338.7832 L567,328.7832 L445,328.7832 " fill="#FBFB77" filter="url(#f1mrmeib7yj1se)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M567,328.7832 L567,338.7832 L577,338.7832 L567,328.7832 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="111" x="451" y="346.3516">create if not exist</text><polygon fill="#A80036" points="58,381.9043,48,385.9043,58,389.9043,54,385.9043" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="52" x2="357" y1="385.9043" y2="385.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="23" x="64" y="381.1621">JWT</text><!--MD5=[4944c061416ae9058dabfa076732a923]
@startuml
"frontend" -> "kubesphere" : OAuth2 login request
"kubesphere" -> "frontend":  Redirect to authorization server with client_id
"frontend" -> "Authorization server": Grant request
"Authorization server" -> "frontend": Redirect to ks-console with grant code
"frontend" -> "kubesphere": Login request with grant code
"kubesphere" -> "Authorization server": Auth by grant code
"Authorization server" -> "kubesphere": access_token & refresh_token
"kubesphere" -> "Resource server": Describe user request
note right: auth by access_token
"Resource server" -> "kubesphere": Describe user response
"kubesphere" -> "kubesphere": User exist?
note right: create if not exist
"kubesphere" -> "frontend": JWT
@enduml

PlantUML version 1.2020.09(Sun May 10 18:51:06 CST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.7+10-b765.53
Operating System: Mac OS X
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>